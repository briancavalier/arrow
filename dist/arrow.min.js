(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.arrow=global.arrow||{})})(this,function(exports){"use strict";function dup(a){return pair(a,a)}function pair(a,b){return[a,b]}function swap(ref){var a=ref[0];var b=ref[1];return[b,a]}function uncurry(f){return function(ref){var a=ref[0];var b=ref[1];return f(a,b)}}var step=function(value,next){return{value:value,next:next}};var time={step:function(value,_){return{value:value,next:time}}};function lift(f){return new Lift(f)}function unsplit(f){return lift(uncurry(f))}function always(a){return lift(constant(a))}function identity(a){return a}function constant(a){return function(_){return a}}var Lift=function Lift(f){this.f=f};Lift.prototype.step=function step$1(t,a){var f=this.f;return step(f(a),this)};function id(){return lift(identity)}function first(ab){return new First(ab)}function second(ab){return dimap(swap,swap,first(ab))}var First=function First(ab){this.ab=ab};First.prototype.step=function step$2(t,ref){var a=ref[0];var c=ref[1];var ref$1=this.ab.step(t,a);var b=ref$1.value;var next=ref$1.next;return step([b,c],first(next))};function unfirst(ab,c){return new Unfirst(ab,c)}var Unfirst=function Unfirst(ab,c){this.ab=ab;this.value=c};Unfirst.prototype.step=function step$3(t,a){var ref=this.ab.step(t,[a,this.value]);var ref_value=ref.value;var b=ref_value[0];var c=ref_value[1];var next=ref.next;return step(b,unfirst(next,c))};function pipe(ab){var rest=[],len=arguments.length-1;while(len-- >0)rest[len]=arguments[len+1];return rest.reduce(pipe2,ab)}function pipe2(ab,bc){return new Pipe(ab,bc)}function dimap(fab,fcd,bc){return pipe2(pipe2(lift(fab),bc),lift(fcd))}function lmap(fab,bc){return pipe2(lift(fab),bc)}function rmap(fbc,ab){return pipe2(ab,lift(fbc))}var Pipe=function Pipe(ab,bc){this.ab=ab;this.bc=bc};Pipe.prototype.step=function step$4(t,a){var ref=this.ab.step(t,a);var b=ref.value;var ab=ref.next;var ref$1=this.bc.step(t,b);var c=ref$1.value;var bc=ref$1.next;return step(c,pipe2(ab,bc))};function split(ab,ac){return lmap(dup,both(ab,ac))}function both(ab,cd){return new Both(ab,cd)}var Both=function Both(ab,cd){this.ab=ab;this.cd=cd};Both.prototype.step=function step$5(t,ref){var a=ref[0];var c=ref[1];var ref$1=this.ab.step(t,a);var b=ref$1.value;var anext=ref$1.next;var ref$2=this.cd.step(t,c);var d=ref$2.value;var cnext=ref$2.next;return step([b,d],both(anext,cnext))};var NoEvent=undefined;function map(f){return function(a){return a===undefined?a:f(a)}}function mergeE(a1,a2){return a1===undefined?a2:a1}function liftE(ab){return new LiftE(ab)}var LiftE=function LiftE(ab){this.ab=ab};LiftE.prototype.step=function step(t,a){if(a===undefined){return{value:NoEvent,next:this}}var ref=this.ab.step(t,a);var value=ref.value;var next=ref.next;return{value:value,next:liftE(next)}};var eventTime={step:function step(t,a){return{value:a===undefined?NoEvent:t,next:this}}};function mapE(f){return lift(map(f))}function as(b){return mapE(function(_){return b})}function sampleWith(f){return lift(function(ref){var a=ref[0];var b=ref[1];return a===undefined?NoEvent:f(a,b)})}function sample(){return sampleWith(pair)}function merge(){return unsplit(mergeE)}function or(left,right){return liftE(pipe(both(left,right),merge()))}function hold(initial){return new Hold(initial)}var Hold=function Hold(value){this.value=value};Hold.prototype.step=function step(t,a){return a===undefined?{value:this.value,next:this}:{value:a,next:hold(a)}};function scanE(f,initial){return new Accum(f,initial)}function scan(f,initial){return pipe(scanE(f,initial),hold(initial))}function accumE(initial){return scanE(function(a,f){return f(a)},initial)}function accum(initial){return pipe(accumE(initial),hold(initial))}var Accum=function Accum(f,value){this.f=f;this.value=value};Accum.prototype.step=function step(t,a){if(a===undefined){return{value:NoEvent,next:this}}var f=this.f;var value=f(this.value,a);return{value:value,next:new Accum(f,value)}};function both$1(input1,input2){return function(f){var dispose1=input1(function(a1){return f([a1,NoEvent])});var dispose2=input2(function(a2){return f([NoEvent,a2])});return function(){return[dispose1(),dispose2()]}}}var never=function(){return noop};var noop=function(){};function newInput(){var _occur;var occur=function(x){if(typeof _occur==="function"){_occur(x)}};var input=function(f){_occur=f;return function(){_occur=undefined}};return[occur,input]}function loop(session,input,sf){var dispose=input(function(a){var ref=session.step();var sample=ref.sample;var nextSession=ref.nextSession;var ref$1=sf.step(sample,a);var ref$1_value=ref$1.value;var _=ref$1_value[0];var nextInput=ref$1_value[1];var next=ref$1.next;dispose=switchInput(nextSession,nextInput,next,dispose)});return dispose}var switchInput=function(session,input,sf,dispose){dispose();return loop(session,input,sf)};function newSession(step,init){return new SteppedSession(step,init)}var countSession=function(){return newSession(function(n){return n+1},0)};var SteppedSession=function SteppedSession(step,value){this._step=step;this.value=value};SteppedSession.prototype.step=function step(){var sample=this._step(this.value);return{sample:sample,nextSession:newSession(this._step,sample)}};var clockSession=function(){return new ClockSession(Date.now())};var ClockSession=function ClockSession(start){this.start=start;this.time=Infinity};ClockSession.prototype.step=function step(){var t=Date.now();if(t<this.time){this.time=t-this.start}return{sample:this.time,nextSession:new ClockSession(this.start)}};exports.bothI=both$1;exports.never=never;exports.newInput=newInput;exports.clockSession=clockSession;exports.countSession=countSession;exports.time=time;exports.lift=lift;exports.unsplit=unsplit;exports.always=always;exports.id=id;exports.first=first;exports.second=second;exports.unfirst=unfirst;exports.pipe=pipe;exports.pipe2=pipe2;exports.dimap=dimap;exports.lmap=lmap;exports.rmap=rmap;exports.split=split;exports.both=both;exports.NoEvent=NoEvent;exports.eventTime=eventTime;exports.mapE=mapE;exports.as=as;exports.sampleWith=sampleWith;exports.sample=sample;exports.merge=merge;exports.or=or;exports.hold=hold;exports.scanE=scanE;exports.scan=scan;exports.accumE=accumE;exports.accum=accum;exports.loop=loop;Object.defineProperty(exports,"__esModule",{value:true})});